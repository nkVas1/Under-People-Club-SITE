# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ—Ñ–∏–ª—è –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 27 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é

---

## üìã –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ë–ï–ó –ø—Ä–µ—Ñ–∏–∫—Å–∞ "UP-" ‚Üí –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞ —Å–∞–π—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–æ—Å—å `UP-undefined` –≤–º–µ—Å—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞.

**–ü—Ä–∏—á–∏–Ω–∞:** Backend –æ—Ç–ø—Ä–∞–≤–ª—è–ª `referral_code`, –Ω–æ frontend –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `ref_code`, –∫–æ—Ç–æ—Ä—ã–π —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª—Å—è –∫–∞–∫ `UP-${telegram_id}` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:** 
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `User` –≤ `authStore.ts` ‚Üí –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `referral_code`, `photo_url`, `membership_level`
- –û–±–Ω–æ–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –≤ `/auth/callback/page.tsx` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `data.user.referral_code` –∏–∑ API
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ QR-–∫–æ–¥–∞ –≤ `ShelterProfile.tsx` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `user.referral_code || user.ref_code` –∫–∞–∫ fallback

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `frontend/store/authStore.ts`
- `frontend/app/auth/callback/page.tsx`
- `frontend/components/dashboard/ShelterProfile.tsx`

---

### 2. ‚ùå –ë–∞–ª–∞–Ω—Å –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è ‚Üí –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 115 UP, —Å–∞–π—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 UP. –ë–∞–ª–∞–Ω—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –±–∞–ª–∞–Ω—Å–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π hook `useSyncBalance.ts` ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –±–∞–ª–∞–Ω—Å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `updateUser()` –≤ store ‚Üí –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –ª—é–±—ã–µ –ø–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–±–Ω–æ–≤–ª–µ–Ω `ShelterProfile.tsx` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `useSyncBalance()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ localStorage ‚Üí –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `frontend/hooks/useSyncBalance.ts` (—Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π)
- `frontend/store/authStore.ts`
- `frontend/app/auth/callback/page.tsx`
- `frontend/components/dashboard/ShelterProfile.tsx`

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
1. –ü—Ä–∏ –≤—Ö–æ–¥–µ: –ë–∞–ª–∞–Ω—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ API
2. –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è GET /api/users/me –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
3. –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å –∏–∑–º–µ–Ω–∏–ª—Å—è: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
4. –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
```

---

### 3. ‚ùå –ê–≤–∞—Ç–∞—Ä –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ `/shelter` ‚Üí –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ê–≤–∞—Ç–∞—Ä –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞, —Ö–æ—Ç—è –µ—Å—Ç—å –Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–º –ø—Ä–æ—Ñ–∏–ª–µ.

**–ü—Ä–∏—á–∏–Ω–∞:** Frontend –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø–æ–ª–µ `avatar_url`, –Ω–æ API –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `photo_url`.

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±–Ω–æ–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ –≤ `/auth/callback/page.tsx` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `data.user.photo_url`
- –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ fallback –≤ `ShelterProfile.tsx`:
  ```tsx
  user.photo_url 
    || user.avatar_url 
    || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.first_name)}&background=8A0303&color=fff`
  ```
- –ï—Å–ª–∏ –∞–≤–∞—Ç–∞—Ä–∞ –Ω–µ—Ç ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `frontend/app/auth/callback/page.tsx`
- `frontend/components/dashboard/ShelterProfile.tsx`

---

### 4. ‚ùå QR-–∫–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É ‚Üí –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** QR-–∫–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª Telegram ID –≤–º–µ—Å—Ç–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞.

**–ü—Ä–∏—á–∏–Ω–∞:** Backend –æ—Ç–ø—Ä–∞–≤–ª—è–ª `referral_code`, –Ω–æ frontend –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `ref_code` –¥–ª—è QR.

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ QR –≤ `ShelterProfile.tsx`:
  ```tsx
  <UserQRCode value={`${SITE_URL}/u/${user.referral_code || user.ref_code}`} />
  ```
- –¢–µ–ø–µ—Ä—å QR –≤–µ–¥–µ—Ç –Ω–∞: `https://under-people-club.vercel.app/u/UP-XXXXX` (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥)

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `frontend/components/dashboard/ShelterProfile.tsx`

---

### 5. ‚ùå WebApp –∫–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å ‚Üí –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∞ "–°–∞–π—Ç (–í–µ–±)" –≤ –±–æ—Ç–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≤–º–µ—Å—Ç–æ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞.

**–ü—Ä–∏—á–∏–Ω–∞:** –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ `/start` –±–æ—Ç–∞ –Ω–µ –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ WebApp –∏–ª–∏ –æ–Ω–∞ —Å—Å—ã–ª–∞–ª–∞—Å—å –Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL.

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±–Ω–æ–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `start.py` –Ω–∞ –±–æ—Ç–µ:
  ```python
  # –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ WebApp, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
  web_app=types.WebAppInfo(url="https://under-people-club.vercel.app/shelter")
  ```
- –¢–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∞ "üåê –°–∞–π—Ç (–í–µ–±)" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `/shelter` (–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üìñ –û –∫–ª—É–±–µ" ‚Üí –≤–µ–¥–µ—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `backend/bot/handlers/start.py`

---

## üöÄ –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| # | –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---|------|----------|--------|
| 1 | `frontend/store/authStore.ts` | –†–∞—Å—à–∏—Ä–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å User, –¥–æ–±–∞–≤–ª–µ–Ω updateUser() | ‚úÖ |
| 2 | `frontend/app/auth/callback/page.tsx` | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ | ‚úÖ |
| 3 | `frontend/components/dashboard/ShelterProfile.tsx` | –ê–≤–∞—Ç–∞—Ä, QR-–∫–æ–¥, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ | ‚úÖ |
| 4 | `frontend/hooks/useSyncBalance.ts` | –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π hook –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ | ‚úÖ |
| 5 | `backend/bot/handlers/start.py` | –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ WebApp | ‚úÖ |

---

## ‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ù–∞ —Å–∞–π—Ç–µ:
- ‚úÖ –ê–≤–∞—Ç–∞—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–∏–ª–∏ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
- ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º "UP-"
- ‚úÖ QR-–∫–æ–¥ –≤–µ–¥–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
- ‚úÖ –ë–∞–ª–∞–Ω—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ü—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ QR ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å

### –ù–∞ –±–æ—Ç–µ:
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "üåê –°–∞–π—Ç (–í–µ–±)" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (`/shelter`)
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "üìñ –û –∫–ª—É–±–µ" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
- ‚úÖ WebApp –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üîÑ –ü–æ—Ä—è–¥–æ–∫ –¥–µ–ø–ª–æ—è

### 1Ô∏è‚É£ **Frontend (Vercel)**
```bash
git add .
git commit -m "fix: —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞, –∞–≤–∞—Ç–∞—Ä, WebApp"
git push origin main
# ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ Vercel
```

### 2Ô∏è‚É£ **Backend (Railway)**
```bash
git add .
git commit -m "fix: WebApp –∫–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç"
git push origin main
# ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ Railway
```

### 3Ô∏è‚É£ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ production**
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://under-people-club.vercel.app/shelter
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤–∞—Ç–∞—Ä ‚Üí –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ ‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å UP-XXXXX
4. –î–æ–∂–¥–∏—Ç–µ—Å—å 30 —Å–µ–∫ ‚Üí –±–∞–ª–∞–Ω—Å –¥–æ–ª–∂–µ–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è
5. –í –±–æ—Ç–µ –Ω–∞–∂–º–∏—Ç–µ "üåê –°–∞–π—Ç (–í–µ–±)" ‚Üí –æ—Ç–∫—Ä–æ–µ—Ç—Å—è /shelter
6. –°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR ‚Üí –¥–æ–ª–∂–µ–Ω –≤–µ—Å—Ç–∏ –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
```

---

## üêõ –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã

### –ë–∞–ª–∞–Ω—Å –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è
**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. ‚úÖ –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage (`auth_token`)
2. ‚úÖ API endpoint `/api/users/me` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ backend
3. ‚úÖ Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `up_coins` –≤ –æ—Ç–≤–µ—Ç–µ
4. ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (—Ä–∞–∑—Ä–µ—à–µ–Ω—ã GET –∑–∞–ø—Ä–æ—Å—ã —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º Authorization)

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network ‚Üí –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/users/me` ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∏ –æ—Ç–≤–µ—Ç

### –ê–≤–∞—Ç–∞—Ä –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. ‚úÖ API –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `photo_url`
2. ‚úÖ –ï—Å–ª–∏ –∞–≤–∞—Ç–∞—Ä–∞ –Ω–µ—Ç ‚Üí –¥–æ–ª–∂–Ω–∞ –≥–µ–Ω–µ—Ä–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –ø–æ–º–æ—â—å—é ui-avatars.com

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Console ‚Üí –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `user.photo_url`

### QR-–∫–æ–¥ –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. ‚úÖ API –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `referral_code`
2. ‚úÖ –ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `UP-`

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Console ‚Üí –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ `user.referral_code`

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö User

```typescript
interface User {
  id: string;                    // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  username: string;              // –Æ–∑–µ—Ä–Ω–µ–π–º (–∏–ª–∏ first_name)
  first_name: string;            // –ò–º—è –∏–∑ Telegram
  role: string;                  // –†–æ–ª—å (ranger, stalker, elder –∏ —Ç.–¥.)
  clan: string;                  // –ö–ª–∞–Ω –∏–ª–∏ —Ñ—Ä–∞–∫—Ü–∏—è
  up_coins: number;              // –ë–∞–ª–∞–Ω—Å –º–æ–Ω–µ—Ç (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
  avatar_url: string;            // URL –∞–≤–∞—Ç–∞—Ä–∞ (–∫–∞–∫ fallback)
  ref_code: string;              // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ (–∫–∞–∫ fallback)
  referral_code: string;         // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –æ—Ç API (primary)
  photo_url?: string;            // URL —Ñ–æ—Ç–æ –æ—Ç API
  membership_level?: string;     // –£—Ä–æ–≤–µ–Ω—å —á–ª–µ–Ω—Å—Ç–≤–∞
  token?: string;                // Auth —Ç–æ–∫–µ–Ω (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –≤ localStorage)
}
```

### API Endpoints –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ

**GET `/api/users/me`** (—Ç—Ä–µ–±—É–µ—Ç Authorization)
```json
Response:
{
  "id": "123",
  "first_name": "John",
  "username": "john_stalker",
  "telegram_id": 123456789,
  "up_coins": 150,
  "photo_url": "https://...",
  "referral_code": "UP-123456",
  "membership_level": "ranger",
  "clan": "unaffiliated"
}
```

**POST `/api/auth/callback`** (–æ–±–º–µ–Ω –∫–æ–¥–∞ –Ω–∞ —Ç–æ–∫–µ–Ω)
```json
Request:
{ "code": "..." }

Response:
{
  "access_token": "...",
  "user": {
    "id": "123",
    "first_name": "John",
    "username": "john_stalker",
    "telegram_id": 123456789,
    "up_coins": 150,
    "photo_url": "https://...",
    "referral_code": "UP-123456",
    "membership_level": "ranger"
  }
}
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ (Redis) –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WebSocket
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–æ—Ç—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–≤–º–µ—Å—Ç–æ 30 —Å–µ–∫ ‚Üí –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
- ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `referral_code` –≤ –æ—Ç–≤–µ—Ç–µ
- ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ backend –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ CORS (Authorization headers)

---

**–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã –∫ production –¥–µ–ø–ª–æ—é! üöÄ**
